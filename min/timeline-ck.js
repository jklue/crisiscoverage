function overviewVis(){var t,e,a;xOverviewScale=d3.time.scale().domain(d3.extent(originalData,function(t){return t.date})).range([0,bbOverview.w]);var i=svg.append("g").attr({transform:"translate("+bbOverview.x+",0)"});a=d3.scale.linear().domain([d3.min(originalData,function(t){return t.total}),d3.max(originalData,function(t){return t.total})]).range([bbOverview.h,0]),t=d3.svg.axis().scale(xOverviewScale).orient("bottom").ticks(20),e=d3.svg.axis().scale(a).orient("left").ticks(3,",");var l=d3.svg.line().x(function(t){return xOverviewScale(t.date)}).y(function(t){return a(t.total)}).interpolate("linear");i.append("g").attr({"class":"x axis",transform:"translate(0,"+bbOverview.h+")"}).call(t),i.append("g").attr({"class":"y axis"}).call(e).append("text").attr("x",-5).attr("y",-bbOverview.h+5).attr("dy","30px").style("text-anchor","end").text("Coverage").style("fill","#09C6FF"),i.append("path").datum(originalData).attr({"class":"line",d:l}).style({stroke:"#09C6FF",fill:"none"}),i.selectAll(".dot").data(originalData).enter().append("circle").attr({"class":"dot",cx:function(t){return xOverviewScale(t.date)},cy:function(t){return a(t.total)},fill:"#55D8FF",r:2}),detailVis()}function detailVis(){function t(){xDetailScale.domain(brush.empty()?xOverviewScale.domain():brush.extent()),l.select(".detailArea").attr("d",n),l.select(".detailPath").attr("d",r),l.selectAll(".dot").attr("cx",function(t){return xDetailScale(t.date)}),l.select(".x.axis").call(e),d3.select(".factpoints").style("display","none")}var e,a,i;xDetailScale=d3.time.scale().domain(d3.extent(dates,function(t){return t.date})).range([0,bbDetail.w]);var l=svg.append("g").attr({"class":"detailFrame",transform:"translate("+bbDetail.x+","+bbDetail.y+")"});i=d3.scale.linear().domain([d3.min(dates,function(t){return t.total}),d3.max(dates,function(t){return t.total})]).range([bbDetail.h,0]),e=d3.svg.axis().scale(xDetailScale).orient("bottom").ticks(7).tickFormat(d3.time.format("%b")),a=d3.svg.axis().scale(i).orient("left").ticks(6);var n=d3.svg.area().x(function(t){return xDetailScale(t.date)}).y0(bbDetail.h).y1(function(t){return i(t.total)}),r=d3.svg.line().x(function(t){return xDetailScale(t.date)}).y(function(t){return i(t.total)}).interpolate("linear");l.append("g").attr({"class":"x axis",transform:"translate(0,"+bbDetail.h+")"}).call(e),l.append("g").attr({"class":"y axis"}).call(a).append("text").attr("x",-5).attr("y",-45).attr("dy","30px").style("text-anchor","end").text("Coverage"),l.append("path").datum(dates).attr("class","detailArea").attr("d",n),l.append("path").datum(dates).attr({"class":"detailPath",d:r}).style({fill:"none"}),tip=d3.tip().html(function(t){return"total: "+t.total}).direction("e").attr("class","d3-tip e"),l.call(tip),l.selectAll(".dot").data(dates).enter().append("circle").attr({"class":"dot",cx:function(t){return xDetailScale(t.date)},cy:function(t){return i(t.total)},r:3}).on("mouseover",tip.show).on("mouseout",tip.hide);var s=svg.append("g").attr("class","hover-line"),c=s.append("line").attr("x1",10).attr("x2",10).attr("y1",0+bbDetail.y).attr("y2",bbDetail.h+bbDetail.y).attr("stroke-width",2).style("stroke","#CCC");d3.select(".timeline").on("mouseover",function(){}).on("mousemove",function(){var t=d3.mouse(this)[0]-margin.left;t>0&&width>t?(c.attr("x1",t).attr("x2",t),c.style("opacity",1)):c.style("opacity",0)}),c.style("opacity",0),brush=d3.svg.brush().x(xOverviewScale).on("brush",t),svg.append("g").attr("class","brush").call(brush).selectAll("rect").attr({height:bbOverview.h,transform:"translate(0,0)"}),d3.select("#reset").on("click",function(){brush.clear(),svg.select(".brush").transition().call(brush),xDetailScale.domain(xOverviewScale.domain()),l.select(".detailArea").transition().attr("d",n),l.select(".detailPath").transition().attr("d",r),l.selectAll(".dot").transition().attr("cx",function(t){return xDetailScale(t.date)}),l.select(".x.axis").transition().call(e),d3.selectAll(".factpoints").style("display","none")}),d3.select("#feblink").on("click",function(){var t=new Date("Jan 1, 2012"),a=new Date("Mar 30, 2012");brush.extent([t,a]),svg.select(".brush").transition().call(brush),xDetailScale.domain(brush.extent()),l.select(".detailArea").transition().attr("d",n),l.select(".detailPath").transition().attr("d",r),l.selectAll(".dot").transition().attr("cx",function(t){return xDetailScale(t.date)}),l.select(".x.axis").transition().call(e),d3.select("#feb").transition().delay(300).style("display","block"),console.log("feb clicked"),d3.selectAll(".factpoints").style("display","none")}),d3.select("#auglink").on("click",function(){var t=new Date("Jul 1, 2012"),a=new Date("Sep 30, 2012");brush.extent([t,a]),svg.select(".brush").transition().call(brush),xDetailScale.domain(brush.extent()),l.select(".detailArea").transition().attr("d",n),l.select(".detailPath").transition().attr("d",r),l.selectAll(".dot").transition().attr("cx",function(t){return xDetailScale(t.date)}),l.select(".x.axis").transition().call(e),d3.select("#aug").transition().delay(300).style("display","block"),console.log("aug clicked"),d3.selectAll(".factpoints").style("display","none")})}var bbDetail,bbOverview,dates,duplicateDates,padding,parseYear,svg,xDetailScale,xOverviewScale,margin={top:50,right:50,bottom:50,left:100},width=960-margin.left-margin.right,height=550-margin.bottom-margin.top;bbOverview={x:0,y:10,w:width,h:50},bbDetail={x:0,y:25,w:width,h:300},padding=30,parseDate=d3.time.format("%Y-%m-%dT%H:%M:%S+00:00").parse,parseDateSimple=d3.time.format("%b %d %Y"),duplicateDates=[],dates=[],svg=d3.select("#timelineVis").append("svg").attr({"class":"timeline",width:width+margin.left+margin.right,height:height+margin.top+margin.bottom}).append("g").attr({transform:"translate("+margin.left+","+margin.top+")"}),svg.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",width).attr("height",height),d3.csv("data/2014-04-03-12.09.57_all_no_text-no2011.csv",function(t){originalData=t;var e=d3.keys(t[0]).filter(function(t){return"AnalysisDate"!==t});originalData.forEach(function(t,e){t.date_published=parseDate(t.date_published),null!=t.date_published&&duplicateDates.push(t.date_published)}),duplicateDates.sort(function(t,e){return d3.ascending(t,e)});var a;return duplicateDates.forEach(function(t,e){var i=parseDateSimple(t);i!=a?(dates.push({date:t,total:1}),a=i):dates[dates.length-1].total++}),detailVis()});