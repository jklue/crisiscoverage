function loadedDataCallBack(e,t,a){var r=topojson.feature(t,t.objects.countries).features,o={};a.forEach(function(e){o[e.query_url]={name:e.query_url,articles:+e.result_count}}),console.log("mediaData: ",o);var l=d3.extent(_.pluck(o,"articles"));return console.log(d3.extent(_.pluck(o,"articles"))),colorScale=d3.scale.pow().exponent(.1).domain(l).interpolate(d3.interpolateRgb).range(["#CCC","#3D8699"]),svg.selectAll(".land").data(r).enter().append("path").attr("class","country").attr("d",path).attr("fill",function(e){return _.has(o,e.properties.name)?(console.log(o[e.properties.name].articles),colorScale(o[e.properties.name].articles)):"white"})}var width=960,height=500,projection=d3.geo.orthographic().scale(250).translate([width/2,height/2]).clipAngle(90),path=d3.geo.path().projection(projection),λ=d3.scale.linear().domain([0,width]).range([-180,180]),φ=d3.scale.linear().domain([0,height]).range([90,-90]),svg=d3.select("#overviewVis").append("svg").attr("width",width).attr("height",height);graticule=d3.geo.graticule(),svg.append("path").datum(graticule).attr("class","graticule").attr("d",path),svg.on("mousemove",function(){var e=d3.mouse(this);projection.rotate([λ(e[0]),φ(e[1])]),svg.selectAll("path").attr("d",path)}),queue().defer(d3.json,"/productiondata/globe.json").defer(d3.csv,"/data/overview/2014-04-12 09.33.11_haiyan-google-country_stats_by_query_name.csv").await(loadedDataCallBack);