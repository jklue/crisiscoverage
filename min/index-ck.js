function ready(t,e,n){var i={type:"Sphere"},o=topojson.feature(e,e.objects.land),a=topojson.feature(e,e.objects.countries).features,r=topojson.mesh(e,e.objects.countries,function(t,e){return t!==e}),d=-1,s=a.length;a=a.filter(function(t){return n.some(function(e){return t.id==e.id?t.name=e.name:void 0})}).sort(function(t,e){return t.name.localeCompare(e.name)}),function h(){d3.transition().duration(1250).each("start",function(){title.text(a[d=(d+1)%s].name)}).tween("rotate",function(){var t=d3.geo.centroid(a[d]),e=d3.interpolate(projection.rotate(),[-t[0],-t[1]]);return function(t){projection.rotate(e(t)),c.clearRect(0,0,width,height),c.fillStyle="#bbb",c.beginPath(),path(o),c.fill(),c.fillStyle="#f00",c.beginPath(),path(a[d]),c.fill(),c.strokeStyle="#fff",c.lineWidth=.5,c.beginPath(),path(r),c.stroke(),c.strokeStyle="#000",c.lineWidth=2,c.beginPath(),path(i),c.stroke()}}).transition().each("end",h)}()}var diameter=320,radius=diameter>>1,width=diameter,height=diameter,projection=d3.geo.orthographic().scale(radius-2).translate([radius,radius]).clipAngle(90).precision(0),canvas=d3.select("#rotatingGlobe").append("canvas").attr("width",width).attr("height",height),c=canvas.node().getContext("2d"),path=d3.geo.path().projection(projection).context(c),title=d3.select("#crisis_name");queue().defer(d3.json,"productiondata/world-110m.json").defer(d3.tsv,"productiondata/crisis-country-names.tsv").await(ready);