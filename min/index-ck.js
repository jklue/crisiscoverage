var diameter=320,radius=diameter>>1,velocity=.01,then=Date.now(),projection=d3.geo.orthographic().scale(radius-2).translate([radius,radius]).clipAngle(90).precision(0),canvas=d3.select("#rotatingGlobe").selectAll("canvas").data(d3.range(1)).enter().append("canvas").attr("width",diameter).attr("height",diameter),path=d3.geo.path().projection(projection);d3.json("/productiondata/rotatingglobe.json",function(t,e){var a=topojson.feature(e,e.objects.land),o={type:"Sphere"};d3.timer(function(){var t=velocity*(Date.now()-then);canvas.each(function(e){var n=[0,0,0],r=this.getContext("2d");n[e]=t,projection.rotate(n),r.clearRect(0,0,diameter,diameter),r.beginPath(),path.context(r)(a),r.fill(),r.beginPath(),path(o),r.stroke()})})});